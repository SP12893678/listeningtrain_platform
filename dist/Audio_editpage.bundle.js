(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{725:function(e,t,a){var i=a(741);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(98).default)("5866cb04",i,!1,{})},739:function(e){e.exports=JSON.parse('{"category":["房子","學校","動物","廚房、餐廳","自然","軍事","街道","活動","樂器","日常生活"],"frequency":["<100","100~1000","1000~2000","2000~4000","4000~7000","7000"],"waveform":["平緩","低頻高","高頻高","中間高","中間高，兩邊低","中間低，兩邊高"]}')},740:function(e,t,a){"use strict";var i=a(725);a.n(i).a},741:function(e,t,a){(t=a(97)(!1)).push([e.i,"\n.jf-title[data-v-949f064c] {\r\n    font-size: 32px;\n}\r\n",""]),e.exports=t},756:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{fluid:""}},[a("v-list-item",{attrs:{"two-line":""}},[a("v-list-item-content",[a("v-list-item-title",{staticClass:"jf-title pa-2"},[e._v("聲音資源編輯")])],1),e._v(" "),a("v-list-item-action",{staticClass:"ml-0 mb-0"},[a("v-btn",{attrs:{"data-v-step":"Audio-editpage-add",text:""},on:{click:e.addAudioData}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-playlist-plus")]),e._v("新增一筆\n            ")],1)],1),e._v(" "),a("v-list-item-action",{staticClass:"ml-0 mb-0"},[a("v-btn",{attrs:{color:"green","data-v-step":"Audio-editpage-category",text:""},on:{click:e.addCategoryAsk}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-shape-plus")]),e._v("新增類別\n            ")],1)],1),e._v(" "),a("v-list-item-action",{staticClass:"ml-0 mb-0"},[a("v-btn",{attrs:{color:"blue","data-v-step":"Audio-editpage-frequency",text:""},on:{click:e.addFrequencyAsk}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-chart-bell-curve")]),e._v("新增頻率\n            ")],1)],1),e._v(" "),a("v-list-item-action",{staticClass:"ml-0 mb-0"},[a("v-btn",{attrs:{color:"purple","data-v-step":"Audio-editpage-waveform",text:""},on:{click:e.addWaveformAsk}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-waveform")]),e._v("新增波形\n            ")],1)],1),e._v(" "),a("v-list-item-action",{staticClass:"ml-0 mb-0"},[a("v-btn",{attrs:{color:"red","data-v-step":"Audio-editpage-save",text:""},on:{click:e.saveAudioData}},[a("v-icon",{attrs:{left:""}},[e._v("mdi-content-save")]),e._v("儲存資源\n            ")],1)],1)],1),e._v(" "),a("v-divider"),e._v(" "),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-list-item",{staticClass:"mt-4",attrs:{"two-line":""}},[a("v-list-item-content",[a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.audio_header,items:e.audio,"item-key":"index","data-v-step":"Audio-editpage-audio-table","multi-sort":""},scopedSlots:e._u([{key:"item.name",fn:function(t){var i=t.item;return[a("v-text-field",{attrs:{rules:e.rules.name,required:"",clearable:""},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"item.name"}})]}},{key:"item.audio_id",fn:function(t){var i=t.item;return[a("v-text-field",{attrs:{rules:e.rules.id,required:"",clearable:""},model:{value:i.audio_id,callback:function(t){e.$set(i,"audio_id",t)},expression:"item.audio_id"}})]}},{key:"item.category",fn:function(t){var i=t.item;return[a("v-select",{attrs:{items:e.category_options,rules:e.rules.category,required:"",multiple:""},scopedSlots:e._u([{key:"selection",fn:function(t){var i=t.item;t.index;return[a("v-chip",{attrs:{color:e.getColor(i),label:"",small:""}},[a("span",[e._v(e._s(i))])])]}}],null,!0),model:{value:i.category,callback:function(t){e.$set(i,"category",t)},expression:"item.category"}})]}},{key:"item.frequency",fn:function(t){var i=t.item;return[a("v-select",{attrs:{items:e.frequency_options,rules:e.rules.frequency,required:"",multiple:""},model:{value:i.frequency,callback:function(t){e.$set(i,"frequency",t)},expression:"item.frequency"}})]}},{key:"item.waveform",fn:function(t){var i=t.item;return[a("v-select",{attrs:{items:e.waveform_options,rules:e.rules.waveform,required:""},model:{value:i.waveform,callback:function(t){e.$set(i,"waveform",t)},expression:"item.waveform"}})]}},{key:"item.upload",fn:function(t){var i=t.item;return[a("v-file-input",{staticClass:"ma-0 pa-0",attrs:{rules:e.rules.file,accept:"audio/mp3, audio/wav","prepend-icon":"mdi-cloud-upload","hide-input":""},on:{change:function(t){return e.onChange(t,i)}},model:{value:i.file,callback:function(t){e.$set(i,"file",t)},expression:"item.file"}})]}},{key:"item.sound",fn:function(t){var i=t.item;return[a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.playAudio(i)}}},[a("v-icon",[e._v("mdi-volume-high")])],1)]}},{key:"item.delete",fn:function(t){var i=t.item;return[a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteAudioData(i)}}},[a("v-icon",[e._v("mdi-delete")])],1)]}}])}),e._v(" "),a("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:e.dialog.body,callback:function(t){e.$set(e.dialog,"body",t)},expression:"dialog.body"}},[a("v-card",[a("v-card-title",[e._v(e._s(e.dialog.title))]),e._v(" "),a("v-card-text",[a("v-combobox",{attrs:{label:"輸入完按Enter鍵插入",multiple:"","small-chips":""},model:{value:e.dialog.items,callback:function(t){e.$set(e.dialog,"items",t)},expression:"dialog.items"}})],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.dialog.body=!1}}},[e._v("離開")]),e._v(" "),a("v-btn",{attrs:{color:"red darken-1",text:""},on:{click:e.addOption}},[e._v("插入")])],1)],1)],1)],1)],1)],1),e._v(" "),a("v-dialog",{attrs:{width:"600"},model:{value:e.alert.dialog,callback:function(t){e.$set(e.alert,"dialog",t)},expression:"alert.dialog"}},[a("v-card",[a("v-card-title",[e._v(e._s(e.alert.title))])],1)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600",persistent:""},model:{value:e.progress.dialog,callback:function(t){e.$set(e.progress,"dialog",t)},expression:"progress.dialog"}},[a("v-card",[a("v-card-title",[e._v(e._s(e.progress.text))]),e._v(" "),a("v-stepper",{attrs:{value:e.stepper.progress}},[a("v-stepper-header",[e._l(e.stepper.steps,(function(t,i){return[a("v-stepper-step",{key:i+"-step",attrs:{step:i,complete:e.stepper.progress>i}},[e._v(e._s(t.text))]),e._v(" "),i+1!==e.stepper.steps.length?a("v-divider",{key:i}):e._e()]}))],2)],1),e._v(" "),a("v-progress-linear",{attrs:{value:e.progress.value,"buffer-value":e.progress.value,color:"light-blue",stream:"",rounded:"",height:"6"}}),e._v(" "),a("v-card-actions",[a("v-btn",{attrs:{text:"",block:""},on:{click:function(t){e.progress.dialog=!1}}},[a("v-icon",[e._v("mdi-check")]),e._v("完成\n                ")],1)],1)],1)],1),e._v(" "),a("v-tour",{attrs:{name:this.$route.name,steps:e.steps}})],1)};i._withStripped=!0;var o=a(51),r=a.n(o),n=a(6),s=a.n(n),l=a(13),u=a.n(l),c=a(739),d=a(16),p={props:["passdata"],data:function(){return{valid:!0,dialog:{body:!1,items:[],title:"新增類別",type:"category"},hello:"world",audio:[],audio_header:[{text:"名稱",align:"start",value:"name"},{text:"代號",value:"audio_id"},{text:"分類",value:"category"},{text:"頻率",value:"frequency"},{text:"波形",value:"waveform"},{text:"上傳",value:"upload",sortable:!1},{text:"聲音",value:"sound",sortable:!1},{text:"刪除",value:"delete",sortable:!1}],category_options:[],frequency_options:[],waveform_options:[],colors:[],audio_player:new Audio,alert:{dialog:!1,title:""},rules:{name:[function(e){return!!e||"必填!"},function(e){return e&&e.length<=10||"最大10個字"}],id:[function(e){return!!e||"必填!"},function(e){return e&&e.length<=20||"最大20個字"}],category:[function(e){return e.length>=1||"至少一種"}],frequency:[function(e){return e.length>=1||"至少一種"}],waveform:[function(e){return!!e||"必填!"}],file:[function(e){return!e||e.size<3e6||"檔案大小必須小於3MB"},function(e){return!e||e.size>0||"需要有聲音檔"}]},progress:{dialog:!1,value:0,text:"儲存進度流程"},stepper:{steps:[{text:"上傳聲音檔"},{text:"儲存聲音資料"}],progress:0},steps:[{target:'[data-v-step="Audio-editpage-audio-table"]',header:{title:"聲音資源編輯資料表"},content:"將列出編輯的聲音資源資料表，可於表中查看並編輯各項內容和屬性，在最右側有刪除按鈕可取消該筆資料新增或編輯。",params:{enableScrolling:!1}},{target:'[data-v-step="Audio-editpage-add"]',header:{title:"新增一筆空白聲音資源"},content:"點選後將新增一筆空白資料的聲音資源於資料表中。",params:{enableScrolling:!1}},{target:'[data-v-step="Audio-editpage-category"]',header:{title:"新增聲音資源類別項目按鈕"},content:"點選此按鈕可增加新的類別，可用於資料編輯中。",params:{enableScrolling:!1}},{target:'[data-v-step="Audio-editpage-frequency"]',header:{title:"新增聲音資源頻率項目按鈕"},content:"點選此按鈕可增加新的頻率，可用於資料編輯中。",params:{enableScrolling:!1}},{target:'[data-v-step="Audio-editpage-waveform"]',header:{title:"新增聲音資源波形項目按鈕"},content:"點選此按鈕可增加新的波形，可用於資料編輯中。",params:{enableScrolling:!1}},{target:'[data-v-step="Audio-editpage-save"]',header:{title:"儲存聲音資源按鈕"},content:"編輯完聲音資源資料後，可點選此按鈕進行儲存。",params:{enableScrolling:!1}}]}},mounted:function(){var e=this;return u()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e.passdata.audio&&e.$router.back(),!(e.passdata.audio.id.length>0)){t.next=4;break}return t.next=4,e.getAudioData();case 4:return t.next=6,e.getAudioFormat();case 6:e.setCategoryColor(),e.passdata.audio.id.length<=0&&e.addAudioData();case 8:case"end":return t.stop()}}),t)})))()},methods:{setCategoryColor:function(){for(var e=0;e<this.category_options.length;e++){var t=Math.round(255*Math.random()),a=Math.round(255*Math.random()),i=Math.round(255*Math.random()),o="rgba(".concat(t,", ").concat(a,", ").concat(i,", 0.5)");this.colors.push(o)}},getAudioData:function(){var e=this;return Object(d.b)({type:"get",amount:"part",items:this.passdata.audio.id}).then((function(t){e.audio=t.data,e.audio.forEach((function(e){e.category=e.category.split(";"),e.frequency=e.frequency.split(";")}))})).catch((function(e){console.error(e)}))},getAudioFormat:function(){this.frequency_options=c.frequency,this.waveform_options=c.waveform,this.category_options=c.category},getColor:function(e){var t=this.category_options.indexOf(e);return this.colors[t]},addCategoryAsk:function(){this.dialog.title="新增類別",this.dialog.type="category",this.dialog.body=!0},addFrequencyAsk:function(){this.dialog.title="新增頻率",this.dialog.type="frequency",this.dialog.body=!0},addWaveformAsk:function(){this.dialog.title="新增波形",this.dialog.type="waveform",this.dialog.body=!0},addOption:function(){var e,t,a,i=this;switch(this.dialog.type){case"category":var o=this.dialog.items.filter((function(e){return i.category_options.indexOf(e)<0}));(e=this.category_options).push.apply(e,r()(o));break;case"frequency":o=this.dialog.items.filter((function(e){return i.frequency_options.indexOf(e)<0}));(t=this.frequency_options).push.apply(t,r()(o));break;case"waveform":o=this.dialog.items.filter((function(e){return i.waveform_options.indexOf(e)<0}));(a=this.waveform_options).push.apply(a,r()(o))}this.dialog.items=[],this.dialog.body=!1},onChange:function(e,t){var a=e;if(null!=e){var i=new FileReader;i.onload=function(e){-1!=["audio/mpeg","audio/wav"].indexOf(a.type)&&(t.sound_src=e.target.result)},i.readAsDataURL(e)}},playAudio:function(e){null!=e.sound_src&&null!=e.sound_src&&(this.audio_player.src=e.sound_src,this.audio_player.play())},isNeedFileUpload:function(e,t){return this.audio.forEach((function(a,i){null!=a.file&&null!=a.file&&(t.push({index:i}),e.push(a.file))})),t.length>0},uploadFiles:function(e,t){var a=this;return u()(s.a.mark((function i(){var o,r;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=new FormData,e.forEach((function(e){return o.append("file[]",e)})),a,r={onUploadProgress:function(e){var t=e.loaded/e.total*100|0;a.progress.value=t}},i.next=6,Object(d.n)(o,{type:"upload",data:t},r.onUploadProgress).then((function(e){e.data.forEach((function(e){a.audio[e.index].sound_src=e.filename,delete a.audio[e.index].file}))}));case 6:case"end":return i.stop()}}),i)})))()},saveAudioData:function(){var e=this;return u()(s.a.mark((function t(){var a,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.form.validate()){t.next=2;break}return t.abrupt("return");case 2:if(e.stepper.progress=0,e.progress.dialog=!0,a=[],i=[],!e.isNeedFileUpload(i,a)){t.next=9;break}return t.next=9,e.uploadFiles(i,a);case 9:new Promise((function(t,a){e.stepper.progress=1;var i=0;e.audio.forEach((function(a,o){Object(d.b)({type:"update",item:a}).then((function(o){o.data.result&&(a.id=o.data.id),++i>=e.audio.length&&t()}))}))})).then((function(){e.stepper.progress=2}));case 11:case"end":return t.stop()}}),t)})))()},addAudioData:function(){this.audio.splice(0,0,{id:"-1",audio_id:"",category:[],created_time:"",frequency:[],name:"",pic_src:"",sound_src:"",waveform:""})},deleteAudioData:function(e){this.audio.splice(this.audio.indexOf(e),1)}}},v=(a(740),a(79)),f=Object(v.a)(p,i,[],!1,null,"949f064c",null);f.options.__file="src/components/manage/Audio-editpage.vue";t.default=f.exports}}]);